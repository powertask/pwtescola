<div class='title_tools'>
  <a class="btn btn-large btn-warning" <%= link_to(t('contract.index'), contracts_path) %> </a>
</div>

<div class='title_page'> <%= t('contract.show') %> </div>

<div class="row marketing">

  <div class="col-sm-6 col-md-3">

    <div class='subtitle_page'> <%= t('contract.title1') %> </div>

    <div class='section'>
      <div class='label1 top req'> <%=t("id") %>: </div>          
        <%= @contract.id %>
      
      <div class='label1 top req'> <%=t("status") %>: </div>
      
        <% if @contract.paid? %>
          <a class="label label-success"><%= t('contract.status.paid') %></a>
        <% else %>
          <%= t('contract.status.' << @contract.status) %>
        <% end %>

      <div class='label1 top req'> <%=t("contract.contract_date") %>: </div>
          <%= @contract.created_at.to_s_br %>

      <div class='label1 top req'> <%=t("contract.debtor") %>: </div>
          <%= link_to(@contract.debtor.origin_code.to_s << " - " << @contract.debtor.name.upcase, show_path(@contract.debtor_id)) %>

      <div class='label1 top req'> <%=t("user.name") %>: </div>
          <%= @contract.user ? @contract.user.name.upcase : 'Não definido'  %>

      <div class='label1 top req'> <%=t("contract.amount_principal") %>: </div>
          <%= @contract.amount_principal.real %>

      <div class='label1 top req'> <%=t("contract.amount_monetary_correction") %>: </div>
          <%= @contract.amount_monetary_correction.real %>

      <div class='label1 top req'> <%=t("contract.amount_interest") %>: </div>
          <%= @contract.amount_interest.real %>

      <div class='label1 top req'> <%=t("contract.amount_fine") %>: </div>
          <%= @contract.amount_fine.real %>

      <div class='label1 top req'> <%=t("contract.amount_tax") %>: </div>
          <%= @contract.amount_tax.real %>

      <div class='label1 top req'> <%=t("contract.total") %>: </div>
          <%= @contract.amount_principal.real + 
              @contract.amount_monetary_correction.real +
              @contract.amount_interest.real + 
              @contract.amount_fine.real + 
              @contract.amount_tax.real
          %>
    </div>
  </div>

  <div class="col-sm-6 col-md-9">

    <div class='title_tools'>
      <% if @contract.open? %>
        <a class="btn btn-large btn-default" <%= link_to('Enviar Boletos', :action => "create_bank_billet", :cod => @contract.id) %></a>
      <% end %>
    </div>

    <div class='subtitle_page'> Boletos para o Contrato </div>
    <table class="table">
      <thead>
        <tr>
          <th>ID</th>
          <th><%= t('status') %></th>
          <th>Nosso Número</th>
          <th>Vencimento</th>
          <th>Valor de Parcela</th>
          <th>Data do Pagamento</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        <% @bank_slips.each do |bank_slip| %>
          <tr>
            <td><%= bank_slip.id %> </td>
            <td>
              <% if bank_slip.waiting? %>
                <a class="label label-default"> Aguardando Envio Boletos</a>
              <% elsif bank_slip.generating? %>
                <a class="label label-primary"><%= t('bank_slip.status.generating') %></a>
              <% elsif bank_slip.open? %>
                <a class="label label-primary"><%= t('bank_slip.status.open') %></a>
              <% elsif bank_slip.canceled? %>
                <a class="label label-warning"><%= t('bank_slip.status.canceled') %></a>
              <% elsif bank_slip.paid? %>
                <a class="label label-success"><%= t('bank_slip.status.paid') %></a>
              <% elsif bank_slip.overdue? %>
                <a class="label label-danger"><%= t('bank_slip.status.overdue') %></a>
              <% else %>
                <a class="label label-default"><%= t('bank_slip.status.'<< bank_slip.status) if bank_slip.status.present? %></a>
              <% end %>
            </td>
            <td><%= bank_slip.our_number unless bank_slip.nil? %> </td>
            <td><%= bank_slip.due_at.to_date.to_s_br %> </td>
            <td><%= bank_slip.amount_principal.real %> </td>
            <td><%= bank_slip.paid_at.nil? ? '' : bank_slip.paid_at.to_s_br %></td>
            <td>
              <%= link_to(t('contract.show_bank_slip'), bank_slip.shorten_url, class: "btn btn-xs btn-default") if bank_slip.shorten_url? %> 

              <%= link_to(t('contract.create_new_due_at'), create_new_due_at_path(bank_slip.id), class: "btn btn-xs btn-default") unless bank_slip.paid?  %> 

              <%= link_to(t('bank_slip.cancel'), bank_slip_cancel_path(bank_slip.id), class: "btn btn-xs btn-danger", remote: true, id: 'cancel_ticket') if bank_slip.present? & (bank_slip.open? || bank_slip.overdue?) %> 

            </td>
          </tr>
        <% end %>
      </tbody>
    </table>


    <div class='subtitle_page'> <%= t('contract.show_contract_ticket') %> </div>
    <table class="table">
      <thead>
        <tr>
          <th>ID</th>
          <th>Documento</th>
          <th>Vencimento</th>
          <th>Valor Principal</th>
          <th>Correção Monetária</th>
          <th>Juros</th>
          <th>Multa</th>
          <th>Taxa</th>
        </tr>
      </thead>
      <tfoot>
        <tr>
          <th></th>
          <th></th>
          <th></th>
          <th><%= @contract_tickets.map{|i|i[:amount_principal]}.inject(:+).real if @contract_tickets %></th>
          <th><%= @contract_tickets.map{|i|i[:amount_monetary_correction]}.inject(:+).real if @contract_tickets %></th>
          <th><%= @contract_tickets.map{|i|i[:amount_interest]}.inject(:+).real if @contract_tickets %></th>
          <th><%= @contract_tickets.map{|i|i[:amount_fine]}.inject(:+).real if @contract_tickets %></th>
          <th><%= @contract_tickets.map{|i|i[:amount_tax]}.inject(:+).real if @contract_tickets %></th>
        </tr>
      </tfoot>
      <tbody>
        <% @contract_tickets.each do |contract_ticket| %>
          <tr>
            <td><%= contract_ticket.id %> </td>
            <td><%= contract_ticket.ticket.description %> </td>
            <td><%= contract_ticket.ticket.due_at.to_s_br %> </td>
            <td><%= contract_ticket.amount_principal.real %> </td>
            <td><%= contract_ticket.amount_monetary_correction.real %> </td>
            <td><%= contract_ticket.amount_interest.real %> </td>
            <td><%= contract_ticket.amount_fine.real %> </td>
            <td><%= contract_ticket.amount_tax.real %> </td>
          </tr>
        <% end %>
      </tbody>
    </table>

  </div>
</div>
